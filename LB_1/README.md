# Лабораторная работа №1

В ходе лабораторной работы был выполнен ряд заданий по исследованию данных о поездках на велосипедах и станциях.
Все запросы выполнялись посредством библиотеки pyspark.

Перед выполнением дальнейших пунктов выполним загрузку данных с csv - файлов.

![1](https://github.com/vasser2323/BigData/assets/73202398/4574e65e-8159-4bef-8238-061893d3c0ce)

## 1) Найли велосипед с максимальным временем пробега

1.1) Данные о поездках группируются по идентификатору велосипеда bike_id.
Для каждого bike_id суммируется продолжительность поездок.
1.2) Результат группировки сортируется в порядке убывания продолжительности поездок, 
чтобы определить велосипед с наибольшей суммарной продолжительностью поездок. 
1.3) Извлекаются bike_id и соответствующая продолжительность для велосипеда 
с наибольшей суммарной продолжительностью поездок.
1.4) Выводится информация о велосипеде с наибольшей суммарной продолжительностью поездок. 

![2](https://github.com/vasser2323/BigData/assets/73202398/1a5e67be-e579-4111-b4c6-cee3059ddd35)

1.5) Полученный результат:

![3](https://github.com/vasser2323/BigData/assets/73202398/d4a4d5bd-f9b1-47f8-8594-a2369d62b31e)

## 2) Найти наибольшее геодезическое расстояние между станциями

2.1) "distance" - функция, которая принимает широту и долготу двух точек и вычисляет 
геодезическое расстояние между ними с помощью формулы Евклидова расстояния на плоскости.

2.2) "distance_udf" - преобразует эту функцию "distance" в PySpark UDF (User Defined Function), 
чтобы можно было использовать её для столбцов DataFrame.

2.3) station_combinations - создаётся DataFrame с различными комбинациями станций путем 
выполнения декартового произведения "crossJoin" DataFrame "stations_data" с самим собой, 
чтобы получить все возможные комбинации станций.

2.4) Вычисление расстояния для каждой пары станций "joined_stations" - новый DataFrame, 
который содержит столбец "distance", в котором вычисляется расстояние с использованием 
ранее определённой UDF distance_udf для каждой комбинации станций.

2.5) "max_distance" - находит максимальное значение в столбце "distance" в DataFrame "joined_stations" 
с помощью функции "agg" и затем собирает этот результат с помощью "collect()".

2.6) Наконец, выводится найденное максимальное геодезическое расстояние между станциями.

![4](https://github.com/vasser2323/BigData/assets/73202398/c1c970d1-6458-47de-9983-0544ede38068)

2.7) Полученный результат:

![5](https://github.com/vasser2323/BigData/assets/73202398/8a7d41b2-b356-416e-ad8a-79980381be24)

## 3) Найти путь велосипеда с максимальным временем пробега через станции

3.1) Из "trip_data" выбираются столбцы "start_station_name", "end_station_name" и "duration". Затем данные сортируются по столбцу "duration" в порядке убывания.

3.2) Из выбранной строки извлекаются данные о начальной станции "start_station_name", конечной станции "end_station_name" и времени поездки "duration".

3.3) Наконец, выводится информация о самой длительной поездке.

![6](https://github.com/vasser2323/BigData/assets/73202398/0ad0cd0b-decf-4a38-b30a-40d41383b446)

3.4) Полученный результат: 

![7](https://github.com/vasser2323/BigData/assets/73202398/a688ef62-ca4c-4671-b2f0-f8c68a2c27bf)

## 4) Найти количество велосипедов в системе

4.1) С помощью функции "agg" агрегируются данные о количестве уникальных велосипедов в системе.

![8](https://github.com/vasser2323/BigData/assets/73202398/4b86db3b-9525-4464-ab36-b267d9a6514e)

4.2) Полученный результат: 

![9](https://github.com/vasser2323/BigData/assets/73202398/0c677ea7-ec02-41d9-8864-817f1764bd96)

## 5) Найти пользователей потративших на поездки более 3 часов

5.1) Группировка по id велосипеда и подсчет общего времени, проведенного в поездке

![10](https://github.com/vasser2323/BigData/assets/73202398/d4322229-08c5-4fb9-9dbf-2ff5c032242c)

5.2) Полученный результат:

![11](https://github.com/vasser2323/BigData/assets/73202398/789bdb22-da10-4d50-bc3c-d348ab4b54bb)





